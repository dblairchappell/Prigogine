1) Implement state masks. -- DONE
2) Implement state transitions
3) Implement messaging system.